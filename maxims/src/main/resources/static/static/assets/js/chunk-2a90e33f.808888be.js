(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2a90e33f"],{"21ef":function(e,t,r){},8896:function(e,t,r){"use strict";r("21ef")},b863:function(e,t,r){"use strict";r.r(t);var l=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"content is-vertical",staticStyle:{display:"flex"},attrs:{"element-loading-text":"加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"}},[r("div",{staticClass:"content-main"},[r("div",{staticClass:"toolbar"},[r("ri-button",{attrs:{right:"新增",type:"primary",icon:"el-icon-fa fa-plus"},on:{click:e.handleAddFirst}},[e._v("新增顶级架构")])],1),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"","row-key":"id","default-expand-all":"","tree-props":{children:"children",hasChildren:"hasChildren"}}},[r("el-table-column",{attrs:{property:"name",label:"名称"}}),r("el-table-column",{attrs:{property:"no",label:"编号",width:"120px"}}),r("el-table-column",{attrs:{property:"leader",label:"负责人",width:"120px"}}),r("el-table-column",{attrs:{property:"phoneNum",label:"联系方式",width:"150px"}}),r("el-table-column",{attrs:{property:"address",label:"地址",sortable:!1,align:"left","show-overflow-tooltip":"",fit:""}}),r("el-table-column",{attrs:{property:"type",label:"类型",width:"100px",formatter:e.typeFormatter}}),r("el-table-column",{attrs:{property:"",label:"操作",fixed:"right",width:"110px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-tooltip",{staticClass:"item",attrs:{content:"添加下级架构",placement:"top"}},[r("ri-button",{attrs:{right:"新增",type:"text",icon:"el-icon-fa fa-plus"},on:{click:function(r){return e.handleAdd(t.row)}}})],1),r("el-tooltip",{staticClass:"item",attrs:{content:"编辑",placement:"top"}},[r("ri-button",{attrs:{right:"编辑",type:"text",icon:"el-icon-edit"},on:{click:function(r){return e.handleEdit(t.row)}}})],1),r("el-tooltip",{staticClass:"item",attrs:{content:"删除",placement:"top"}},[r("ri-button",{attrs:{right:"删除",type:"text",icon:"el-icon-delete",disabled:-1===t.row.type},on:{click:function(r){return e.handleDel(t.row)}}})],1)]}}])})],1)],1),r("el-dialog",{key:e.key,attrs:{title:e.dialogTitle,visible:e.dialogTableVisible,width:"550px",top:"5vh"},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[e.dialogTableVisible?r("div",[r("el-form",{ref:"ruleForm",attrs:{"label-width":"100px",model:e.ruleForm,rules:e.rules}},[-1!=e.ruleForm.type?r("el-form-item",{attrs:{label:"类型",prop:"type"}},[r("el-select",{staticStyle:{width:"90%"},attrs:{placeholder:"请选择"},model:{value:e.ruleForm.type,callback:function(t){e.$set(e.ruleForm,"type",t)},expression:"ruleForm.type"}},e._l(e.struTypes,(function(e,t){return r("el-option",{key:t,attrs:{label:e.name,value:e.no}})})),1)],1):e._e(),-1!=e.ruleForm.type?r("div",{staticClass:"structure-cascader-changge"},["add-first"!=e.dialogAction&&e.ruleForm.parentId?r("el-form-item",{attrs:{label:"上级架构",prop:"parentId"}},[r("el-cascader",{ref:"cascader",staticStyle:{width:"90%"},attrs:{options:e.source,"show-all-levels":!1,props:{expandTrigger:"hover",emitPath:!1,checkStrictly:!0,label:"name",value:"id"}},on:{change:e.handleCascaderChangge},model:{value:e.ruleForm.parentId,callback:function(t){e.$set(e.ruleForm,"parentId",t)},expression:"ruleForm.parentId"}})],1):e._e(),r("el-form-item",{attrs:{label:"名称",prop:"name"}},[r("el-input",{staticStyle:{width:"90%"},attrs:{placeholder:"名称",maxlength:"30"},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),r("el-form-item",{attrs:{label:"编号",prop:"code"}},[r("el-input",{staticStyle:{width:"90%"},attrs:{maxlength:"30"},model:{value:e.ruleForm.no,callback:function(t){e.$set(e.ruleForm,"no",t)},expression:"ruleForm.no"}})],1),r("el-form-item",{attrs:{label:"联系人",prop:"leader"}},[r("el-input",{staticStyle:{width:"90%"},attrs:{placeholder:"联系人",maxlength:"30"},model:{value:e.ruleForm.leader,callback:function(t){e.$set(e.ruleForm,"leader",t)},expression:"ruleForm.leader"}})],1),r("el-form-item",{attrs:{label:"联系电话",prop:"phoneNum"}},[r("el-input",{staticStyle:{width:"90%"},attrs:{placeholder:"联系电话",maxlength:"11"},model:{value:e.ruleForm.phoneNum,callback:function(t){e.$set(e.ruleForm,"phoneNum",t)},expression:"ruleForm.phoneNum"}})],1),r("el-form-item",{attrs:{label:"地址",prop:"address"}},[r("el-input",{staticStyle:{width:"90%"},attrs:{placeholder:"地址",maxlength:"50"},model:{value:e.ruleForm.address,callback:function(t){e.$set(e.ruleForm,"address",t)},expression:"ruleForm.address"}})],1),r("el-form-item",{attrs:{label:"坐标点"}},[r("el-input",{staticStyle:{width:"69%"},attrs:{placeholder:"请输入"},model:{value:e.ruleForm.position,callback:function(t){e.$set(e.ruleForm,"position",t)},expression:"ruleForm.position"}}),r("el-button",{attrs:{type:"primary"},on:{click:e.handleMap}},[e._v("坐标拾取")])],1),r("el-form-item",{attrs:{label:"描述"}},[r("el-input",{staticStyle:{width:"90%"},attrs:{type:"textarea",rows:3,placeholder:"请输入内容"},model:{value:e.ruleForm.memo,callback:function(t){e.$set(e.ruleForm,"memo",t)},expression:"ruleForm.memo"}})],1)],1):e._e()],1)],1):e._e(),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.dialogTableVisible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.handleSave}},[e._v("确 定")])],1)])],1)},a=[],o=(r("7f7f"),r("ac6a"),{components:{},data:function(){return{title:"组织架构",key:Date.parse(new Date),dialogTitle:"",dialogTableVisible:!1,dialogAction:"",tableData:[],struList:[],loading:!1,source:[],ruleForm:{id:"",name:"",no:0,leader:"",phoneNum:"",address:"",parentId:"",type:0,logoId:"",title:"",position:"",memo:""},rules:{type:[{required:!0,message:"请选择架构类型",trigger:"blur"}],parentId:[{required:!0,message:"请选择上级架构",trigger:"blur"}],name:[{required:!0,message:"请输入名称",trigger:"blur"}]},struTypes:[{no:0,name:"其他"},{no:1,name:"省"},{no:2,name:"市"},{no:3,name:"区"},{no:4,name:"企业/用户"},{no:5,name:"配电房"}]}},created:function(){this.handleSearch()},activated:function(){},mounted:function(){},watch:{},methods:{typeFormatter:function(e,t,r){return this.struTypes[r]},handleSearch:function(){var e=this;this.loading=!0,this.$api.structure.structureTree().then((function(t){e.tableData=t.data,e.loading=!1}))},handleAdd:function(e){var t=this;this.dialogTitle="添加下级架构",this.dialogAction="add",this.ruleForm={id:"",name:"",no:0,leader:"",phoneNum:"",address:"",parentId:"",type:0,logoId:"",title:"",position:"",memo:""},this.$api.structure.structureTree().then((function(r){var l=function e(r){r.forEach((function(t){t.children&&(t.children.length?e(t.children):t.children=void 0)})),t.source=r};l(r.data),t.ruleForm.parentId=e.id,t.dialogTableVisible=!0}))},handleEdit:function(e){var t=this;this.dialogTitle="编辑架构",this.dialogAction="edit",this.findStructureUp(e.id),this.$api.structure.getStructureDetail(e.id).then((function(e){t.ruleForm=e.data,t.dialogTableVisible=!0}))},handleDel:function(e){var t=this;this.$api.structure.structureDelete(e.id).then((function(e){200==e.status&&(t.$message({message:"删除成功！",type:"success"}),t.handleSearch())}))},handleAddFirst:function(){this.dialogTitle="添加顶级架构",this.dialogAction="add-first",this.ruleForm={id:"",name:"",no:0,leader:"",phoneNum:"",address:"",parentId:"",type:0,logoId:"",title:"",position:"",memo:""},this.dialogTableVisible=!0},findStructureUp:function(e){var t=this;this.$api.structure.getStructureUp(e).then((function(e){var r=function e(r){r.forEach((function(t){t.children&&(t.children.length?e(t.children):t.children=void 0)})),t.source=r};r(e.data)}))},handleSave:function(){var e=this;this.$refs["ruleForm"].validate((function(t){if(!t)return!1;if(e.ruleForm.no=parseInt(e.ruleForm.no),"edit"==e.dialogAction)e.$api.structure.updateStructure(e.ruleForm).then((function(t){200==t.status&&(e.dialogTableVisible=!1,e.$message({message:"操作成功！",type:"success"}),e.handleSearch())}));else if("add"==e.dialogAction){var r={name:e.ruleForm.name,no:e.ruleForm.no,type:e.ruleForm.type,leader:e.ruleForm.leader,phoneNum:e.ruleForm.phoneNum,address:e.ruleForm.address,position:e.ruleForm.position,memo:e.ruleForm.memo,parentId:e.ruleForm.parentId};e.$api.structure.addStructure(r).then((function(t){200==t.status&&(e.dialogTableVisible=!1,e.$message({message:"操作成功！",type:"success"}),e.handleSearch())}))}else if("add-first"==e.dialogAction){var l={name:e.ruleForm.name,no:e.ruleForm.no,type:e.ruleForm.type,leader:e.ruleForm.leader,phoneNum:e.ruleForm.phoneNum,address:e.ruleForm.address,position:e.ruleForm.position,memo:e.ruleForm.memo,parentId:""};e.$api.structure.addStructure(l).then((function(t){200==t.status&&(e.dialogTableVisible=!1,e.$message({message:"操作成功！",type:"success"}),e.handleSearch())}))}}))},handleCascaderChangge:function(e){e&&(this.$refs.cascader.dropDownVisible=!1)},handleMap:function(){window.open("http://lbs.amap.com/console/show/picker")}}}),i=o,n=(r("8896"),r("2877")),s=Object(n["a"])(i,l,a,!1,null,"f71c46ce",null);t["default"]=s.exports}}]);