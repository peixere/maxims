(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d2259b7"],{e4b4:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content is-vertical",attrs:{id:"userManagement"}},[a("div",{staticClass:"content-main"},[a("el-form",{attrs:{inline:!0,"label-position":"right"}},[a("el-form-item",{attrs:{label:"姓名"}},[a("el-input",{staticStyle:{width:"180px"},attrs:{placeholder:"请输入"},model:{value:e.searchForm.name,callback:function(t){e.$set(e.searchForm,"name",t)},expression:"searchForm.name"}})],1),a("el-form-item",{attrs:{label:"用户名"}},[a("el-input",{staticStyle:{width:"180px"},attrs:{placeholder:"请输入"},model:{value:e.searchForm.account,callback:function(t){e.$set(e.searchForm,"account",t)},expression:"searchForm.account"}})],1),a("el-form-item",{attrs:{label:"架构"}},[a("el-cascader",{ref:"searchCascader",staticStyle:{width:"180px"},attrs:{options:e.structures,props:{multiple:!0,checkStrictly:!0,label:"name",value:"id"},"show-all-levels":!1,clearable:""},model:{value:e.searchForm.structureList,callback:function(t){e.$set(e.searchForm,"structureList",t)},expression:"searchForm.structureList"}})],1),a("el-form-item",{attrs:{label:"角色",prop:"roleId"}},[a("el-select",{staticStyle:{width:"180px"},attrs:{"value-key":"id",multiple:"",placeholder:"请选择",clearable:"",filterable:""},model:{value:e.searchForm.roleIdList,callback:function(t){e.$set(e.searchForm,"roleIdList",t)},expression:"searchForm.roleIdList"}},e._l(e.searchRoleList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-button",{staticStyle:{"margin-bottom":"18px"},attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.handleSearch}},[e._v("搜索")])],1),a("div",{staticClass:"toolbar"},[a("ri-button",{attrs:{right:"新增",type:"primary",icon:"el-icon-fa fa-plus"},on:{click:e.handleAdd}},[e._v("新增用户")]),a("ri-button",{attrs:{right:"删除",type:"danger",icon:"el-icon-delete",disabled:e.sels.length<1},on:{click:e.batchDelete}},[e._v("批量删除")])],1),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:""},on:{"selection-change":e.selsChange}},[a("el-table-column",{attrs:{type:"selection",fixed:"",width:"40px",align:"center"}}),a("el-table-column",{attrs:{type:"index",label:"序号",width:"45px",align:"center"}}),a("el-table-column",{attrs:{property:"name",label:"用户姓名","min-width":"100px"}}),a("el-table-column",{attrs:{property:"account",label:"用户帐号","min-width":"80px"}}),a("el-table-column",{attrs:{property:"structure",label:"所属组织","min-width":"200px"}}),a("el-table-column",{attrs:{property:"role",label:"帐号角色","min-width":"150px"}}),a("el-table-column",{attrs:{property:"mobile",label:"手机号码","min-width":"100px"}}),a("el-table-column",{attrs:{property:"email",label:"用户邮箱","min-width":"150px"}}),a("el-table-column",{attrs:{label:"帐号身份",fit:"",formatter:e.identityFormatter,width:"100px"}}),a("el-table-column",{attrs:{label:"帐号状态",property:"state",formatter:e.stateFormatter,"min-width":"70px","header-align":"center"}}),a("el-table-column",{attrs:{property:"updated",label:"修改时间","min-width":"140px;",align:"center"}}),a("el-table-column",{attrs:{property:"",label:"操作",fixed:"right",width:"60px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tooltip",{staticClass:"item",attrs:{content:"编辑",placement:"top"}},[a("ri-button",{staticClass:"table-btn",attrs:{right:"编辑",type:"text",icon:"el-icon-edit"},on:{click:function(a){return e.handleEdit(t.row)}}})],1),a("el-tooltip",{staticClass:"item",attrs:{content:"删除",placement:"top"}},[a("ri-button",{staticClass:"table-btn",attrs:{right:"删除",type:"text",icon:"el-icon-delete"},on:{click:function(a){return e.handleDel(t.row)}}})],1)]}}])})],1),a("el-pagination",{attrs:{layout:"total, sizes, prev, pager, next, jumper","page-sizes":[10,20,50,100],"page-size":e.searchForm.page.size,total:e.searchForm.page.total},on:{"current-change":e.pageChange,"size-change":e.handleSizeChange}})],1),a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogTableVisible,width:"500px"},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[e.dialogTableVisible?a("div",[a("el-form",{ref:"add-editform",attrs:{"label-width":"100px",model:e.addEditform,rules:e.rules}},[a("el-form-item",{attrs:{label:"用户帐号",prop:"account"}},[a("el-input",{staticStyle:{width:"90%"},attrs:{placeholder:"用户帐号",maxlength:"30",readonly:"edit"==e.dialogAction},model:{value:e.addEditform.account,callback:function(t){e.$set(e.addEditform,"account",t)},expression:"addEditform.account"}})],1),a("el-form-item",{attrs:{label:"用户姓名",prop:"name"}},[a("el-input",{staticStyle:{width:"90%"},attrs:{placeholder:"用户姓名",maxlength:"30"},model:{value:e.addEditform.name,callback:function(t){e.$set(e.addEditform,"name",t)},expression:"addEditform.name"}})],1),a("el-form-item",{attrs:{label:"所属组织",prop:"structure"}},[a("el-cascader",{key:e.structures.id,ref:"cascader",staticStyle:{width:"90%"},attrs:{options:e.structures,"show-all-levels":!1,props:{multiple:!0,checkStrictly:!0,emitPath:!1,label:"name",value:"id"}},on:{change:e.hangdCascaderChangeStructure},model:{value:e.addEditform.structureIdList,callback:function(t){e.$set(e.addEditform,"structureIdList",t)},expression:"addEditform.structureIdList"}})],1),a("el-form-item",{attrs:{label:"所属角色",prop:"role"}},[a("el-select",{staticStyle:{width:"90%"},attrs:{multiple:"",placeholder:"请选择"},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.addEditform.roleIdList,callback:function(t){e.$set(e.addEditform,"roleIdList",t)},expression:"addEditform.roleIdList"}},e._l(e.addEditRoleList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"手机号码",prop:"mobile"}},[a("el-input",{staticStyle:{width:"90%"},attrs:{placeholder:"手机号码",maxlength:"11"},model:{value:e.addEditform.mobile,callback:function(t){e.$set(e.addEditform,"mobile",t)},expression:"addEditform.mobile"}})],1),a("el-form-item",{attrs:{label:"用户邮箱",prop:"email"}},[a("el-input",{staticStyle:{width:"90%"},attrs:{placeholder:"用户邮箱"},model:{value:e.addEditform.email,callback:function(t){e.$set(e.addEditform,"email",t)},expression:"addEditform.email"}})],1),a("el-form-item",{attrs:{label:"帐号状态",prop:"address"}},[a("el-select",{staticStyle:{width:"90%"},attrs:{placeholder:"请选择"},model:{value:e.addEditform.state,callback:function(t){e.$set(e.addEditform,"state",t)},expression:"addEditform.state"}},e._l(e.stateTypes,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"用户类型"}},[a("el-select",{staticStyle:{width:"90%"},attrs:{placeholder:"请选择"},model:{value:e.addEditform.userType,callback:function(t){e.$set(e.addEditform,"userType",t)},expression:"addEditform.userType"}},e._l(e.userTypes,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1):e._e(),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogTableVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.handleSave}},[e._v("确 定")])],1)])],1)},r=[],l=(a("ac6a"),{components:{},data:function(){return{title:"帐号管理",dialogAction:"",dialogTitle:"",dialogTableVisible:!1,structures:[],tableData:[],searchRoleList:[],addEditRoleList:[],stateTypes:[{value:0,label:"已注册"},{value:1,label:"已激活"},{value:2,label:"已锁定"}],userTypes:[{value:0,label:"未知"},{value:1,label:"WEB端用户"},{value:2,label:"APP用户"}],sels:[],searchForm:{name:"",account:"",roleList:[{}],structureList:[],page:{number:1,size:10,total:0}},addEditform:{id:"",structureList:[],structureIdList:[],name:"",account:"",roleList:[],roleIdList:[],mobile:"",email:"",state:0,userType:1},rules:{account:[{required:!0,message:"请输入用户帐号",trigger:"blur"},{min:2,max:20,message:"用户帐号必须是2-20位字母、数字、下划线",trigger:"blur"}],name:[{required:!0,message:"请输入用户姓名",trigger:"blur"},{min:2,max:25,message:"长度在 2 到 25 个字符",trigger:"blur"}],mobile:[{required:!1,message:"请输入手机号码",trigger:"blur"}],email:[{required:!1,message:"请输入用户邮箱",trigger:"blur"},{type:"email",required:!1,message:"用户邮箱格式不正确",trigger:"blur"}]},userId:"",tableStru:""}},created:function(){this.searchForm={structureList:[],page:{number:1,size:10,total:0}},this.pageChange(1),this.getStructureTree(!0)},watch:{},methods:{getStructureTree:function(e){var t=this;this.$api.user.findStrTree().then((function(a){var i=[],r=0,l=function e(a){a.forEach((function(t){t.children&&(i[r++]=t.id,t.children.length?e(t.children):t.children=void 0)})),t.structures=a};l(a.data),e&&i.length&&t.$api.user.findRoles(i).then((function(e){t.searchRoleList=e.data}))}))},handleSearch:function(){var e=this;if(this.searchForm.structureList.length){var t=this.$refs.searchCascader.getCheckedNodes();if(t.length)for(var a=0;a<t.length;a++)this.searchForm.structureList[a]=t[a].data}this.$api.user.findUserPage(this.searchForm).then((function(t){e.tableData=t.data,e.searchForm.page.total=t.page.total}))},handleSave:function(){var e=this;this.$refs["add-editform"].validate((function(t){if(!t)return console.log("else====>",e.addEditform),!1;e.addEditform.structureIdList.length&&e.addEditform.roleIdList.length?(e.addEditform.structureList=[],e.addEditform.roleList=[],"edit"==e.dialogAction?e.$api.user.updateUesr(e.addEditform).then((function(t){200==t.status&&(e.dialogTableVisible=!1,e.$message({message:"修改成功！",type:"success"}),e.pageChange(1))})):"add"==e.dialogAction&&e.$api.user.addUesr(e.addEditform).then((function(t){200==t.status&&(e.dialogTableVisible=!1,e.$message({message:"添加成功！",type:"success"}),e.pageChange(1))}))):e.$message({message:"请选择组织架构与角色！",type:"warning"})}))},handleAdd:function(){this.dialogTitle="添加用户",this.getStructureTree(!1),this.addEditform={id:"",structureList:[],structureIdList:[],fullname:"",account:"",roleList:[],roleIdList:[],mobile:"",email:"",state:0,userType:0},this.dialogAction="add",this.dialogTableVisible=!0},handleEdit:function(e){var t=this;this.dialogTitle="编辑用户",this.dialogAction="edit",this.getStructureTree(!1),this.$api.user.findUserDetail(e.id).then((function(e){if(t.addEditform=e.data,e.data.structureList.length){var a=0;t.addEditform.structureIdList=[],e.data.structureList.forEach((function(e){t.addEditform.structureIdList[a++]=e.id}))}if(t.addEditform.structureIdList,length&&(t.$api.user.findRoles(t.addEditform.structureIdList).then((function(e){t.addEditRoleList=e.data})),e.data.roleList.length)){var i=0;t.addEditform.roleIdList=[],e.data.roleList.forEach((function(e){t.addEditform.roleIdList[i++]=e.id}))}t.dialogTableVisible=!0}))},hangdCascaderChangeStructure:function(){var e=this,t=this.addEditform.structureIdList;t.length?this.$api.user.findRoles(t).then((function(t){if(e.addEditRoleList=t.data,e.addEditRoleList.length){var a=[],i=0;e.addEditRoleList.forEach((function(t){for(var r=0;r<e.addEditform.roleIdList.length;r++)t.id==e.addEditform.roleIdList[r]&&(a[i++]=e.addEditform.roleIdList[r])})),e.addEditform.roleIdList=a}else e.addEditform.roleIdList=[]})):(this.addEditRoleList=[],this.addEditform.roleIdList=[])},pageChange:function(e){e&&(this.searchForm.page.number=e),this.handleSearch()},handleSizeChange:function(e){this.searchForm.page.size=e,this.handleSearch()},batchDelete:function(){var e=this;console.log("点击了批量删除",this.sels);for(var t=[],a=0;a<this.sels.length;a++)t[a]=this.sels[a].id;this.$api.user.deleteUesrByIds(t).then((function(){e.$message({message:"批量删除成功！",type:"success"}),e.pageChange(1)}))},handleDel:function(e){var t=this,a=this;this.$confirm("此操作将永久删除该数据, 您确定要继续删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.$api.user.deleteUesr(e.id).then((function(e){200==e.status&&(t.$message({message:"删除成功！",type:"success"}),t.handleSearch())}))}))},selsChange:function(e){return this.sels=e,!0},identityFormatter:function(e){var t="";switch(e.identity){case 0:t="系统运维人员";break;case 1:t="用户/客户";break;case 10:t="预付费-户主";break}return t},stateFormatter:function(e){var t="";switch(e.state){case 0:t="已注册";break;case 1:t="已激活";break;case 2:t="已锁定";break}return t}}}),s=l,o=a("2877"),d=Object(o["a"])(s,i,r,!1,null,"c829941a",null);t["default"]=d.exports}}]);