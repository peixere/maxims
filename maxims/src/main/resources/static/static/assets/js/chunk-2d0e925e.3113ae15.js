(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0e925e"],{"8bfd":function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content is-vertical",attrs:{id:"tenantManagement"}},[a("div",{staticClass:"content-main"},[a("el-form",{attrs:{inline:!0,"label-position":"right"}},[a("el-form-item",{attrs:{label:"工序类型名称"}},[a("el-input",{staticStyle:{width:"180px"},attrs:{placeholder:"请输入"},model:{value:e.searchForm.stepName,callback:function(t){e.$set(e.searchForm,"stepName",t)},expression:"searchForm.stepName"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search fa-plus"},on:{click:e.handleSearch}},[e._v("搜索")])],1)],1),a("div",{staticClass:"toolbar"},[a("el-button",{attrs:{type:"primary",icon:"el-icon-fa fa-plus"},on:{click:e.handleAdd}},[e._v("新增租户")]),a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",disabled:e.sels.length<1},on:{click:e.batchDelete}},[e._v("批量删除")])],1),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:""},on:{"selection-change":function(t){e.sels=t}}},[a("el-table-column",{attrs:{type:"selection",fixed:"",width:"45px",align:"center"}}),a("el-table-column",{attrs:{type:"index",label:"序号",width:"46px",align:"center"}}),a("el-table-column",{attrs:{property:"stepName",label:"工序名称","min-width":"110px"}}),a("el-table-column",{attrs:{label:"工序类型","min-width":"150px",formatter:e.processTypeFormatter}}),a("el-table-column",{attrs:{property:"updated",label:"修改日期",width:"180px",align:"center"}}),a("el-table-column",{attrs:{label:"组织架构","min-width":"150px",formatter:e.structureFormatter}}),a("el-table-column",{attrs:{property:"disabled",label:"状态",width:"100px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:t.row.disabled?"danger":"success","disable-transitions":""}},[t.row.disabled?a("label",[e._v("停用")]):a("label",[e._v("启用")])])]}}])}),a("el-table-column",{attrs:{property:"",label:"操作",fixed:"right",width:"200px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"table-btn",attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(a){return e.handleEdit(t.row)}}},[e._v("编辑")]),a("el-button",{staticClass:"table-btn",attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(a){return e.handleDel(t.row)}}},[e._v("删除")]),a("el-button",{staticClass:"table-btn",attrs:{type:"text",icon:"el-icon-document-add"},on:{click:function(a){return e.handleVariable(t.row)}}},[e._v("变量定义")])]}}])})],1),a("el-pagination",{attrs:{layout:"total, sizes, prev, pager, next, jumper","page-sizes":[10,20,50,100],"page-size":e.searchForm.page.size,total:e.searchForm.page.total},on:{"current-change":e.pageChange,"size-change":function(t){e.searchForm.page.size=t,e.pageChange()}}})],1),a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogTableVisible,width:"500px",top:"15vh"},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[e.dialogTableVisible?a("div",[a("el-form",{ref:"ruleForm",attrs:{"label-width":"130px",model:e.addEditform,rules:e.rules}},[a("el-form-item",{attrs:{label:"工序名称",prop:"stepName"}},[a("el-input",{staticStyle:{width:"90%"},attrs:{placeholder:"工序名称"},model:{value:e.addEditform.stepName,callback:function(t){e.$set(e.addEditform,"stepName",t)},expression:"addEditform.stepName"}})],1),a("el-form-item",{attrs:{label:"状态",prop:"disabled"}},[[a("el-radio",{attrs:{label:!1},model:{value:e.addEditform.disabled,callback:function(t){e.$set(e.addEditform,"disabled",t)},expression:"addEditform.disabled"}},[e._v("启用")]),a("el-radio",{attrs:{label:!0},model:{value:e.addEditform.disabled,callback:function(t){e.$set(e.addEditform,"disabled",t)},expression:"addEditform.disabled"}},[e._v("停用")])]],2),a("el-form-item",{attrs:{label:"工序类型",prop:"processTypeId"}},[a("el-select",{staticStyle:{width:"90%"},attrs:{placeholder:"请选择"},model:{value:e.addEditform.processTypeId,callback:function(t){e.$set(e.addEditform,"processTypeId",t)},expression:"addEditform.processTypeId"}},e._l(e.processType,(function(e){return a("el-option",{key:e.id,attrs:{label:e.typeName,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"组织架构",prop:"structure"}},[a("el-cascader",{ref:"cascader",staticStyle:{width:"90%"},attrs:{options:e.structures,"show-all-levels":!1,props:{expandTrigger:"hover",emitPath:!1,checkStrictly:!0,label:"name",value:"id"}},on:{change:e.handleCascaderChangge},model:{value:e.addEditform.structureId,callback:function(t){e.$set(e.addEditform,"structureId",t)},expression:"addEditform.structureId"}})],1)],1)],1):e._e(),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.handelCancel}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.handleSave}},[e._v("确 定")])],1)]),a("el-drawer",{attrs:{title:"变量定义",visible:e.variableDrawer,"before-close":e.handleClose,direction:"rtl",size:"50%"},on:{"update:visible":function(t){e.variableDrawer=t}}},[e.variableDrawer?a("process-variable",{attrs:{row:e.row}}):e._e()],1)],1)},r=[],i=(a("7f7f"),a("ac6a"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"toolbar"},[a("el-button",{attrs:{type:"primary",icon:"el-icon-fa fa-plus"},on:{click:e.handleAddVariable}},[e._v("新增变量")])],1),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:""}},[a("el-table-column",{attrs:{type:"index",fixed:"",label:"序号",width:"46px",align:"center"}}),a("el-table-column",{attrs:{property:"variableType",label:"工序",formatter:e.formatterVariableType}}),a("el-table-column",{attrs:{property:"variableType",label:"工序类型",formatter:e.formatterVariableType}}),a("el-table-column",{attrs:{property:"variableType",label:"工序类型变量","min-width":"100px",formatter:e.formatterVariableType}}),a("el-table-column",{attrs:{property:"variableName",label:"变量名称",fit:""}}),a("el-table-column",{attrs:{property:"variableType",label:"变量类型",formatter:e.formatterVariableType}}),a("el-table-column",{attrs:{property:"variableValue",label:"常量值",formatter:e.formatterVariableValue}}),a("el-table-column",{attrs:{property:"",label:"操作",fixed:"right",width:"150px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"table-btn",attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(a){return e.handleEditVar(t.row)}}},[e._v("编辑")]),a("el-button",{staticClass:"table-btn",attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(a){return e.handleDelVar(t.row)}}},[e._v("删除")])]}}])})],1),a("el-dialog",{attrs:{title:e.dialogVariableTitle,modal:!1,visible:e.dialogTableVariable,width:"600px",top:"5vh"},on:{"update:visible":function(t){e.dialogTableVariable=t}}},[e.dialogTableVariable?a("div",[a("el-form",{ref:"ruleForm",attrs:{"label-width":"150px",model:e.addEditform,rules:e.rules}},[a("el-form-item",{attrs:{label:"变量名称",prop:"variableName"}},[a("el-input",{staticStyle:{width:"90%"},attrs:{placeholder:"变量名称"},model:{value:e.addEditform.variableName,callback:function(t){e.$set(e.addEditform,"variableName",t)},expression:"addEditform.variableName"}})],1),a("el-form-item",{attrs:{label:"变量类型",prop:"variableType"}},[a("el-select",{staticStyle:{width:"90%"},attrs:{placeholder:"请选择"},model:{value:e.addEditform.variableType,callback:function(t){e.$set(e.addEditform,"variableType",t)},expression:"addEditform.variableType"}},e._l(e.variableType,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),0==e.addEditform.variableType?a("el-form-item",{attrs:{label:"常量值",prop:"variableValue"}},[a("el-input",{staticStyle:{width:"90%"},attrs:{placeholder:"常量值"},model:{value:e.addEditform.variableValue,callback:function(t){e.$set(e.addEditform,"variableValue",e._n(t))},expression:"addEditform.variableValue"}})],1):e._e()],1)],1):e._e(),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.handelCancel}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.handleSave}},[e._v("确 定")])],1)])],1)}),s=[],o={components:{},props:{row:{type:Object}},data:function(){var e=this,t=function(t,a,l){if(""===a)l(new Error("请输入变量名称"));else{for(var r=0;r<e.nameString.length;r++)e.nameString[r]==a&&l();l(new Error("请输入正确的变量名称"))}};return{dialogVariableAction:"",dialogVariableTitle:"",dialogTableVariable:!1,tableData:[],nameString:[],variableType:[{value:0,label:"类型常量"},{value:1,label:"工序常量"},{value:2,label:"采集变量"},{value:3,label:"台账变量"}],searchVariable:{pointId:"",processStepId:"",processTypeId:"",processTypeVariableId:""},addEditform:{id:"",processTypeId:"",variableName:"",variableType:"",variableValue:""},rules:{variableName:[{validator:t,trigger:"blur"}],variableType:[{required:!0,message:"请选择变量类型",trigger:"change"}],variableValue:[{required:!0,message:"请输入常量值"},{type:"number",message:"常量值必须为数字值"}]}}},created:function(){this.searchVariable.processStepId=this.row.id,this.findAll()},watch:{},methods:{findAll:function(){var e=this;this.$api.processstepvariable.findPSV(this.searchVariable).then((function(t){console.log("工序变量---\x3e",t),e.tableData=t.data}))},formatterVariableType:function(e){return this.variableType[e.variableType].label},formatterVariableValue:function(e){return 0==e.variableType?e.variableValue:""},handelCancel:function(){this.dialogTableVariable=!1},handleSave:function(){var e=this;this.$refs["ruleForm"].validate((function(t){if(!t)return!1;0!=e.addEditform.variableType&&(e.addEditform.variableValue=""),e.addEditform.processTypeId=e.row.id,"edit"==e.dialogVariableAction?e.$api.processTypeVariable.updatePTV(e.addEditform).then((function(){e.dialogTableVariable=!1,e.$message({message:"修改工序类型变量成功！",type:"success"}),e.findAll()})):"add"==e.dialogVariableAction&&e.$api.processTypeVariable.addPTV(e.addEditform).then((function(){e.dialogTableVariable=!1,e.$message({message:"新增工序类型变量成功！",type:"success"}),e.findAll()}))}))},handleAddVariable:function(){this.dialogVariableTitle="新增变量",this.dialogVariableAction="add",this.addEditform={id:"",variableName:"",variableType:0,variableValue:""},this.dialogTableVariable=!0},handleEditVar:function(e){var t=this;this.dialogVariableTitle="编辑变量",this.dialogVariableAction="edit",this.$api.processTypeVariable.findPTVDetail(e.id).then((function(e){t.addEditform=e.data,0!=t.addEditform.variableType&&(t.addEditform.variableValue=""),t.dialogTableVariable=!0}))},handleDelVar:function(e){var t=this;this.$api.processTypeVariable.deletePTV(e.id).then((function(){t.$message({message:"删除工序类型变量成功！",type:"success"}),t.findAll()}))}}},d=o,n=a("2877"),c=Object(n["a"])(d,i,s,!1,null,"4c2fbd40",null),p=c.exports,u={components:{"process-variable":p},data:function(){var e=this,t=function(t,a,l){""===e.addEditform.structureId?l(new Error("请选择组织架构！")):l()};return{title:"工序管理",dialogAction:"",dialogTitle:"",dialogTableVisible:!1,variableDrawer:!1,row:{},structures:[],structuresMap:[],processType:[],tableData:[],sels:[],searchForm:{stepName:"",page:{number:1,size:10,total:0}},addEditform:{id:"",stepName:"",processTypeId:"",disabled:!1,structureId:""},rules:{stepName:[{required:!0,message:"请输入工序类型名称",trigger:"blur"}],structure:[{validator:t,trigger:"blur"}],processTypeId:[{required:!0,message:"请选择工序类型",trigger:"change"}]}}},created:function(){this.getStructureTrss(),this.getProcessType(),this.pageChange(1)},watch:{},methods:{pageChange:function(e){var t=this;e&&(this.searchForm.page.number=e),this.$api.processStep.findProcessStepPage(this.searchForm).then((function(e){t.tableData=e.data,t.searchForm.page.total=e.page.total}))},handleSearch:function(){this.pageChange(1)},handelCancel:function(){this.dialogTableVisible=!1,this.pageChange()},getStructureTrss:function(){var e=this;this.$api.processStep.getStructureTree().then((function(t){var a=function t(a){a.forEach((function(a){a.children&&(e.structuresMap[a.id]=a.name,a.children.length?t(a.children):a.children=void 0)})),e.structures=a};a(t.data)}))},getProcessType:function(){var e=this;this.$api.processStep.findProcessType({}).then((function(t){e.processType=t.data}))},handleAdd:function(){this.dialogTitle="添加工序",this.dialogAction="add",this.addEditform={id:"",stepName:"",disabled:!1,structureId:""},this.getProcessType(),this.getStructureTrss(),this.dialogTableVisible=!0},handleEdit:function(e){var t=this;this.dialogTitle="修改工序",this.dialogAction="edit",this.getStructureTrss(),this.$api.processStep.findProcessStepDetail(e.id).then((function(e){t.addEditform=e.data,t.dialogTableVisible=!0}))},handleSave:function(){var e=this;this.$refs["ruleForm"].validate((function(t){if(!t)return!1;"edit"==e.dialogAction?e.$api.processStep.updateProcessStep(e.addEditform).then((function(){e.dialogTableVisible=!1,e.pageChange(1),e.$message({message:"编辑工序成功！",type:"success"})})):"add"==e.dialogAction&&e.$api.processStep.addProcessStep(e.addEditform).then((function(){e.dialogTableVisible=!1,e.pageChange(1),e.$message({message:"添加工序成功！",type:"success"})}))}))},handleDel:function(e){var t=this;this.$api.processStep.deleteProcessStep(e.id).then((function(e){200==e.status&&(t.pageChange(1),t.$message({message:e.message,type:"success"}))}))},batchDelete:function(){for(var e=this,t=[],a=0;a<this.sels.length;a++)t[a]=this.sels[a].id;this.$api.processStep.deleteProcessStepByIds(t).then((function(){e.$message({message:"批量删除租户成功！",type:"success"}),e.pageChange(1)}))},handleCascaderChangge:function(e){e&&(this.$refs.cascader.dropDownVisible=!1)},handleVariable:function(e){this.row=e,this.variableDrawer=!0},handleClose:function(){this.pageChange(1),this.variableDrawer=!1},processTypeFormatter:function(e){var t="";return this.processType.forEach((function(a){a.id==e.processTypeId&&(t=a.typeName)})),t},structureFormatter:function(e){var t="";return this.structuresMap[e.structureId]&&(t=this.structuresMap[e.structureId]),t}}},b=u,h=Object(n["a"])(b,l,r,!1,null,"e5700c4a",null);t["default"]=h.exports}}]);